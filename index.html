<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Messaging</title>
</head>
<body>
    <div id="room-code-container">
        <button id="create-room">Create Room</button>
        <input id="join-room" placeholder="Enter Room Code (5 digits)" maxlength="5" />
        <button id="join-button">Join Room</button>
        <div id="room-code"></div>
    </div>

    <ul id="messages"></ul>
    <form id="form" action="">
        <input id="m" autocomplete="off" /><button>Send</button>
    </form>

    <div id="user-list"></div>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        $(function () {
            const socket = io();

            // Room creation
            $('#create-room').click(function () {
                socket.emit('create room');
            });

            // Room joining
            $('#join-button').click(function () {
                const roomCode = $('#join-room').val();
                if (/^\d{5}$/.test(roomCode)) {
                    socket.emit('join room', roomCode);
                } else {
                    alert('Please enter a valid 5-digit room code.');
                }
            });

            // Listen for room code
            socket.on('room code', function (roomCode) {
                $('#room-code').text('Room Code: ' + roomCode);
            });

            // Update user list
            socket.on('update users', function (users) {
                const userList = users.map(userId => '<li>' + userId + '</li>').join('');
                $('#user-list').html('<strong>Users in Room:</strong><ul>' + userList + '</ul>');
            });

            // Receive and display chat messages
            socket.on('chat message', function (data) {
                $('#messages').append($('<li>').text(data.id + ': ' + data.message));
            });

            // Handle invalid room code
            socket.on('invalid room', function () {
                alert('Invalid room code. Please enter a valid 5-digit room code or create a new room.');
            });

            // Send chat messages
            $('form').submit(function () {
                const message = $('#m').val();
                if (message.trim() !== '') {
                    socket.emit('chat message', message);
                }
                $('#m').val('');
                return false;
            });
        });
    </script>
</body>
</html>
